import { DocumentProcessor } from '../lib/data/document-processor';
import { MedicalVectorStore } from '../lib/data/vectorstore';
import dotenv from 'dotenv';

// Load environment variables
dotenv.config({ path: '.env.local' });

async function uploadDocuments() {
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ“š MEDICAL DOCUMENTS UPLOAD TO PINECONE');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  try {
    // Step 1: Process PDFs
    console.log('STEP 1: Processing PDF documents...\n');
    const processor = new DocumentProcessor();
    const documents = await processor.processAllDocuments();

    if (documents.length === 0) {
      console.log('\nâš ï¸  No documents to upload!');
      console.log('\nğŸ“Œ To add documents:');
      console.log('   1. Create folder: data/medical-documents/');
      console.log('   2. Add your PDFs: pp.pdf, jj.pdf, etc.');
      console.log('   3. Run this script again\n');
      return;
    }

    // Step 2: Show statistics
    console.log('\nSTEP 2: Document Statistics\n');
    const stats = processor.getDocumentStats(documents);
    console.log(`ğŸ“Š Statistics:`);
    console.log(`   â€¢ Total documents: ${stats.totalDocuments}`);
    console.log(`   â€¢ Total characters: ${stats.totalCharacters.toLocaleString()}`);
    console.log(`   â€¢ Average size: ${stats.averageSize.toLocaleString()} chars`);
    console.log(`   â€¢ Specialties: ${stats.specialties.join(', ')}`);

    // Step 3: Upload to Pinecone
    console.log('\n\nSTEP 3: Uploading to Pinecone...\n');
    const vectorStore = new MedicalVectorStore();
    await vectorStore.uploadDocuments(documents);

    // Step 4: Success message
    console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
    console.log('âœ… UPLOAD COMPLETE!');
    console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');
    console.log('Your medical documents are now searchable in Pinecone!');
    console.log('\nNext steps:');
    console.log('  â€¢ Run: npm run test-search (to test RAG)');
    console.log('  â€¢ Start app: npm run dev');
    console.log('  â€¢ Begin examinations!\n');
  } catch (error) {
    console.error('\n Upload failed:', error);
    process.exit(1);
  }
}

uploadDocuments();